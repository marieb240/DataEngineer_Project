{% extends "base.html" %}

{% block title %}Top 10 - VidIQ Stats{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-lg-12">
        <h1>üëë Top 10 des cha√Ænes YouTube</h1>
        <p class="text-muted">S√©lectionnez le crit√®re de classement</p>
    </div>
</div>

<!-- Boutons de s√©lection du tri -->
<div class="row mb-4">
    <div class="col-lg-12">
        <div class="btn-group" role="group">
            <a href="/top10?sort_by=rank" class="btn {% if sort_by == 'rank' %}btn-danger{% else %}btn-outline-danger{% endif %}">
                üìä Top 10 par Rang
            </a>
            <a href="/top10?sort_by=salary" class="btn {% if sort_by == 'salary' %}btn-success{% else %}btn-outline-success{% endif %}">
                üí∞ Top 10 par Salaire
            </a>
            <a href="/top10?sort_by=videos" class="btn {% if sort_by == 'videos' %}btn-info{% else %}btn-outline-info{% endif %}">
                üé¨ Top 10 par Vid√©os
            </a>
            <a href="/top10?sort_by=views" class="btn {% if sort_by == 'views' %}btn-warning{% else %}btn-outline-warning{% endif %}">
                üëÅÔ∏è Top 10 par Vues
            </a>
            <a href="/top10?sort_by=views_per_video" class="btn {% if sort_by == 'views_per_video' %}btn-secondary{% else %}btn-outline-secondary{% endif %}">
                üéØ Top 10 par Vues/Vid√©o
            </a>
        </div>
    </div>
</div>

<!-- Titre dynamique selon le tri -->
<div class="row mb-3">
    <div class="col-lg-12">
        <h4>
            {% if not sort_by %}
            Choisis un filtre pour afficher un Top 10
            {% elif sort_by == 'salary' %}
            üí∞ Top 10 par Salaire Estim√©
            {% elif sort_by == 'videos' %}
            üé¨ Top 10 par Nombre de Vid√©os
            {% elif sort_by == 'views' %}
            üëÅÔ∏è Top 10 par Nombre de Vues
            {% elif sort_by == 'views_per_video' %}
            üéØ Top 10 par Vues/Vid√©o
            {% else %}
            üìä Top 10 par Rang
            {% endif %}
        </h4>
        <p class="text-muted mb-0">
            {% if not sort_by %}
            Clique sur un filtre pour decouvrir un classement.
            {% elif sort_by == 'rank' %}
            Le classement officiel des chaines les plus populaires au monde !
            {% elif sort_by == 'salary' %}
            Un top 10 qui met en avant les youtubers les mieux r√©mun√©r√©s (estimations) !
            {% elif sort_by == 'videos' %}
            Le top des chaines les plus productives en nombre de videos !
            {% elif sort_by == 'views' %}
            Le top 10 des chaines qui cumulent le plus de vues !
            {% elif sort_by == 'views_per_video' %}
            Le top 10 des chaines qui font le plus de vues par video !
            {% endif %}
        </p>
    </div>
</div>

<!-- Affichage sous forme de cartes pour le top 10 -->
{% if channels %}
<div class="row">
    {% for channel in channels %}
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="card h-100">
            <div class="card-body">
                <!-- M√©daille pour le rang -->
                <div class="text-center mb-3">
                    {% if loop.index == 1 %}
                        <span style="font-size: 3rem;">ü•á</span>
                    {% elif loop.index == 2 %}
                        <span style="font-size: 3rem;">ü•à</span>
                    {% elif loop.index == 3 %}
                        <span style="font-size: 3rem;">ü•â</span>
                    {% else %}
                        <span class="badge bg-dark" style="font-size: 1.2rem;">{{ loop.index }}</span>
                    {% endif %}
                </div>
                
                <h5 class="card-title text-center">{{ channel.channel_name }}</h5>
                
                <hr>
                
                <!-- Affichage conditionnel selon le crit√®re de tri -->
                {% if sort_by == 'salary' %}
                    <div class="mb-2">
                        <small class="text-muted">Revenus mensuels estim√©s</small>
                        <div class="fw-bold" style="color: #28a745; font-size: 1.2rem;">
                            {{ channel.estimated_monthly_earnings or 'N/A' }}
                        </div>
                    </div>
                    <div class="mb-2">
                        <small class="text-muted">Vues totales</small>
                        <div class="fw-bold">
                            {{ '{:,.1f}'.format(channel.total_views/1000000000) }}B
                        </div>
                    </div>
                    <div>
                        <small class="text-muted">Abonn√©s</small>
                        <div class="fw-bold">
                            {{ '{:,.0f}'.format(channel.subscribers/1000000) }}M
                        </div>
                    </div>
                {% elif sort_by == 'videos' %}
                    <div class="mb-2">
                        <small class="text-muted">Nombre de vid√©os</small>
                        <div class="fw-bold" style="color: #17a2b8; font-size: 1.2rem;">
                            {{ "{:,}".format(channel.videos) }}
                        </div>
                    </div>
                    <div class="mb-2">
                        <small class="text-muted">Abonn√©s</small>
                        <div class="fw-bold">
                            {{ '{:,.0f}'.format(channel.subscribers/1000000) }}M
                        </div>
                    </div>
                    <div>
                        <small class="text-muted">Vues totales</small>
                        <div class="fw-bold">
                            {{ '{:,.1f}'.format(channel.total_views/1000000000) }}B
                        </div>
                    </div>
                {% elif sort_by == 'views' %}
                    <div class="mb-2">
                        <small class="text-muted">Vues totales</small>
                        <div class="fw-bold" style="color: #ffc107; font-size: 1.2rem;">
                            {{ '{:,.1f}'.format(channel.total_views/1000000000) }}B
                        </div>
                    </div>
                    <div class="mb-2">
                        <small class="text-muted">Abonn√©s</small>
                        <div class="fw-bold">
                            {{ '{:,.0f}'.format(channel.subscribers/1000000) }}M
                        </div>
                    </div>
                    <div>
                        <small class="text-muted">Vid√©os</small>
                        <div class="fw-bold">
                            {{ "{:,}".format(channel.videos) }}
                        </div>
                    </div>
                {% elif sort_by == 'views_per_video' %}
                    <div class="mb-2">
                        <small class="text-muted">Vues / Vid√©o</small>
                        <div class="fw-bold" style="color: #f97316; font-size: 1.2rem;">
                            {{ "{:,}".format(channel.views_per_video | int) }}
                        </div>
                    </div>
                    <div class="mb-2">
                        <small class="text-muted">Vues totales</small>
                        <div class="fw-bold">
                            {{ '{:,.1f}'.format(channel.total_views/1000000000) }}B
                        </div>
                    </div>
                    <div>
                        <small class="text-muted">Vid√©os</small>
                        <div class="fw-bold">
                            {{ "{:,}".format(channel.videos) }}
                        </div>
                    </div>
                {% else %}
                    <!-- Par d√©faut : affichage classique -->
                    <div class="mb-2">
                        <small class="text-muted">Abonn√©s</small>
                        <div class="fw-bold" style="color: #111;">
                            {{ '{:,.0f}'.format(channel.subscribers/1000000) }}M
                        </div>
                    </div>
                    
                    <div class="mb-2">
                        <small class="text-muted">Vues totales</small>
                        <div class="fw-bold">
                            {{ '{:,.1f}'.format(channel.total_views/1000000000) }}B
                        </div>
                    </div>
                    
                    <div>
                        <small class="text-muted">Vid√©os</small>
                        <div class="fw-bold">
                            {{ "{:,}".format(channel.videos) }}
                        </div>
                    </div>
                {% endif %}
                
                <hr>
                
                <!-- Barre de progression (compar√© au #1) -->
                <small class="text-muted">Compar√© au #1</small>
                <div class="progress mt-2" style="height: 8px;">
                    <div 
                        class="progress-bar bg-danger" 
                        role="progressbar" 
                        style="width: {{ (channel.subscribers / channels[0].subscribers * 100) if channels else 0 }}%"
                    ></div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="row">
    <div class="col-lg-12">
        <div class="card-dark">
            <div class="text-secondary">
                S√©lectionne un filtre ci-dessus pour afficher un classement.
            </div>
        </div>
    </div>
</div>
{% endif %}

{% endblock %}
