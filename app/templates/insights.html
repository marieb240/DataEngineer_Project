{% extends "base.html" %}

{% block title %}Insights - VidIQ Stats{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-lg-12">
        <h1>üß† Insights & Cha√Ænes sous-cot√©es</h1>
        <p class="text-muted">Analyses bas√©es sur les ratios et statistiques globales.</p>
    </div>
</div>

<!-- KPI globaux -->
<div class="row">
    <div class="col-md-4">
        <div class="stat-box">
            <div class="stat-label">Moyenne abonn√©s</div>
            <div class="stat-number">{{ "{:,}".format(stats.avg_subscribers) }}</div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="stat-box">
            <div class="stat-label">M√©diane abonn√©s</div>
            <div class="stat-number">{{ "{:,}".format(stats.median_subscribers) }}</div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="stat-box">
            <div class="stat-label">Moyenne vues</div>
            <div class="stat-number">{{ "{:,}".format(stats.avg_views) }}</div>
        </div>
    </div>
</div>

<!-- Underrated channels -->
<div class="row mt-4">
    <div class="col-lg-12">
        <h3>‚≠ê Cha√Ænes sous-cot√©es (vues / abonn√©s √©lev√©)</h3>
        <div class="table-responsive mt-3">
            <table class="table table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>#</th>
                        <th>Cha√Æne</th>
                        <th>Abonn√©s</th>
                        <th>Vues</th>
                        <th>Vues / Abonn√©</th>
                    </tr>
                </thead>
                <tbody>
                    {% for channel in underrated %}
                    <tr>
                        <td><span class="badge bg-danger">{{ channel.rank }}</span></td>
                        <td><strong>{{ channel.name }}</strong></td>
                        <td>{{ "{:,}".format(channel.subscribers) }}</td>
                        <td>{{ "{:,}".format(channel.total_views) }}</td>
                        <td>{{ "{:.2f}".format(channel.views_per_subscriber) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Top views per video -->
<div class="row mt-4">
    <div class="col-lg-12">
        <h3>üéØ Top vues par vid√©o</h3>
        <div class="table-responsive mt-3">
            <table class="table table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>#</th>
                        <th>Cha√Æne</th>
                        <th>Vid√©os</th>
                        <th>Vues</th>
                        <th>Vues / Vid√©o</th>
                    </tr>
                </thead>
                <tbody>
                    {% for channel in top_views_per_video %}
                    <tr>
                        <td><span class="badge bg-danger">{{ channel.rank }}</span></td>
                        <td><strong>{{ channel.name }}</strong></td>
                        <td>{{ "{:,}".format(channel.videos) }}</td>
                        <td>{{ "{:,}".format(channel.total_views) }}</td>
                        <td>{{ "{:,}".format(channel.views_per_video | int) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

{% endblock %}